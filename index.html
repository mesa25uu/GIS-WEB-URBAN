<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Urban Map - Oxnehaga</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css">
  <style>
    html, body { height: 100%; width: 100%; margin: 0; padding: 0; display: flex; font-family: 'Segoe UI', sans-serif; }
    #sidePanel { width: 280px; background-color: #1f2a38; color: white; padding: 20px; z-index: 5; box-shadow: 2px 0 10px rgba(0,0,0,0.5); overflow-y: auto; }
    #viewDiv { flex: 1; height: 100vh; position: relative; background-color: #eee; }
    
    #infoPanel { 
      position: absolute; top: 20px; right: 20px; width: 300px; max-height: 70vh; 
      overflow-y: auto; background: white; border-radius: 8px; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.4); z-index: 10; border: 1px solid #ccc; 
    }
    .info-header { background: #4A90E2; color: white; padding: 10px 15px; border-radius: 8px 8px 0 0; font-weight: bold; }
    #infoContent { padding: 15px; font-size: 13px; color: #333; line-height: 1.6; }
    
    .layer-item { margin-bottom: 10px; display: flex; align-items: center; background: rgba(255,255,255,0.1); padding: 8px; border-radius: 4px; }
    .layer-item input { margin-right: 10px; cursor: pointer; }
    
    table { width: 100%; border-collapse: collapse; }
    td { padding: 6px 4px; border-bottom: 1px solid #eee; vertical-align: top; }
    .attr-key { font-weight: bold; color: #666; width: 40%; font-size: 11px; text-transform: uppercase; }
    
    .project-button {
      display: inline-block; margin-top: 10px; padding: 10px 15px; 
      background: #d9534f; color: white; text-decoration: none; 
      border-radius: 4px; font-weight: bold; width: 100%; text-align: center;
      box-sizing: border-box;
    }
    .project-button:hover { background: #c9302c; }
  </style>
</head>
<body>

  <div id="sidePanel">
    <h2 style="color: #4A90E2; margin: 0;">GIS Web Urban</h2>
    <hr style="opacity: 0.2; margin: 15px 0;">
    <div id="controls"></div>
  </div>

  <div id="viewDiv">
    <div id="infoPanel">
      <div class="info-header">Feature Details</div>
      <div id="infoContent">Click on a building or object to see its information.</div>
    </div>
  </div>

  <script src="https://js.arcgis.com/4.29/"></script>

  <script>
    require([
      "esri/Map", "esri/views/SceneView", "esri/layers/GeoJSONLayer", "esri/widgets/Home"
    ], function(Map, SceneView, GeoJSONLayer, Home) {

      // The ID of the building we want to highlight in Red
      const targetID = "86068c15-afde-4284-90fc-ad8735b25416";
      
      const map = new Map({ basemap: "topo-vector", ground: "world-elevation" });

      const view = new SceneView({
        container: "viewDiv",
        map: map,
        camera: {
          position: { longitude: 14.2622409, latitude: 57.7781582, z: 5000 },
          tilt: 0,
          heading: 0
        },
        popupEnabled: false 
      });

      view.ui.add(new Home({ view: view }), "top-left");

      // --- 1. THE RED BUILDING RENDERER ---
      // This tells the map: if 'OBJEKTIDENTITET' is your targetID, make it Red.
      const buildingRenderer = {
        type: "unique-value",
        field: "OBJEKTIDENTITET", // This matches the field name in your screenshot
        defaultSymbol: {
          type: "polygon-3d",
          symbolLayers: [{ 
            type: "extrude", 
            size: 15, 
            material: { color: "#4A90E2" }, 
            edges: { type: "solid", color: "white", size: 1 } 
          }]
        },
        uniqueValueInfos: [{
          value: targetID,
          symbol: {
            type: "polygon-3d",
            symbolLayers: [{ 
              type: "extrude", 
              size: 20, // Making the red building slightly taller so it pops out
              material: { color: "#ff0000" }, 
              edges: { type: "solid", color: "white", size: 2 } 
            }]
          }
        }]
      };

      const areaRenderer = {
        type: "simple",
        symbol: { type: "simple-fill", color: [0, 0, 0, 0], outline: { color: "#FFD700", width: 3 } }
      };

      // --- 2. LAYERS ---
      const areaLayer = new GeoJSONLayer({ url: "Oxnehaga-Area.geojson", renderer: areaRenderer, outFields: ["*"] });
      const mainByggnad = new GeoJSONLayer({ url: "Main_byggnad.geojson", renderer: buildingRenderer, outFields: ["*"] });
      const schoolLayer = new GeoJSONLayer({ url: "Oxnehaga_school.geojson", renderer: buildingRenderer, outFields: ["*"] });
      const schoolRoute = new GeoJSONLayer({ url: "Oxnehaga_school_route.geojson", outFields: ["*"] });
      const trainStation = new GeoJSONLayer({ url: "Huskvarna_train_station.geojson", outFields: ["*"] });
      const trainLines = new GeoJSONLayer({ url: "train.geojson", outFields: ["*"] });

      map.addMany([areaLayer, mainByggnad, schoolLayer, schoolRoute, trainStation, trainLines]);

      // --- 3. TOGGLES ---
      const controls = document.getElementById("controls");
      function addToggle(label, layers) {
        const div = document.createElement("div");
        div.className = "layer-item";
        const chk = document.createElement("input");
        chk.type = "checkbox"; chk.checked = true;
        chk.onchange = (e) => layers.forEach(lyr => lyr.visible = e.target.checked);
        const span = document.createElement("span"); span.innerText = label;
        div.appendChild(chk); div.appendChild(span);
        controls.appendChild(div);
      }

      addToggle("Area Boundary", [areaLayer]);
      addToggle("Main Buildings", [mainByggnad]);
      addToggle("Schools & Route", [schoolLayer, schoolRoute]);
      addToggle("Train Info", [trainStation, trainLines]);

      // --- 4. CLICK EVENT ---
      view.on("click", (event) => {
        view.hitTest(event).then((response) => {
          const results = response.results.filter(r => r.graphic);
          
          if (results.length > 0) {
            const graphic = results[0].graphic;
            const attr = graphic.attributes;

            let tableHTML = "<table>";
            for (let key in attr) {
              if (attr[key] !== null && attr[key] !== undefined && attr[key] !== "") {
                tableHTML += `<tr><td class="attr-key">${key}</td><td>${attr[key]}</td></tr>`;
              }
            }
            tableHTML += "</table>";

            // Check if this object contains the target ID
            const isSpecialObject = Object.values(attr).includes(targetID);

            if (isSpecialObject) {
              tableHTML += `
                <div style="margin-top: 15px; border-top: 2px solid #ff0000; padding-top: 10px;">
                  <p style="font-weight: bold; color: #ff0000; margin-bottom: 5px;">ðŸ”´ Special Project Data:</p>
                  <a href="Project4.html" target="_blank" class="project-button">Open Project 4 File</a>
                </div>`;
            }

            document.getElementById("infoContent").innerHTML = tableHTML;
          } else {
            document.getElementById("infoContent").innerHTML = "No feature selected.";
          }
        });
      });
    });
  </script>
</body>
</html>
