<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Urban Map - Oxnehaga</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css">

  <style>
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #sidePanel {
      width: 250px;
      background-color: #1f2a38;
      color: white;
      padding: 20px;
      z-index: 5;
    }

    /* ðŸŸ¢ THE FIX: Explicit height ensures the map doesn't collapse to 0px */
    #viewDiv {
      flex: 1;
      height: 100vh; 
      position: relative;
    }

    #infoPanel {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 260px;
      background: rgba(255, 255, 255, 0.95);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 10;
    }
  </style>
</head>

<body>

  <div id="sidePanel">
    <h2>GIS Web Urban</h2>
    <hr>
    <p>Click building features to see details in the info panel.</p>
  </div>

  <div id="viewDiv">
    <div id="infoPanel">
      <strong>Feature Info</strong>
      <div id="infoContent">Click a feature...</div>
    </div>
  </div>

  <script src="https://js.arcgis.com/4.29/"></script>

  <script>
    require([
      "esri/Map",
      "esri/views/SceneView",
      "esri/layers/GeoJSONLayer"
    ], function(Map, SceneView, GeoJSONLayer) {

      // This makes your flat 2D data pop out in 3D
      const buildingRenderer = {
        type: "simple",
        symbol: {
          type: "polygon-3d",
          symbolLayers: [{
            type: "extrude",
            size: 12, // Height in meters
            material: { color: "#4A90E2" },
            edges: { type: "solid", color: "white", size: 1 }
          }]
        }
      };

      const map = new Map({
        basemap: "topo-vector",
        ground: "world-elevation"
      });

      const view = new SceneView({
        container: "viewDiv",
        map: map,
        camera: {
          position: [14.2626, 57.7766, 1500], // Longitude, Latitude, Elevation
          tilt: 50
        }
      });

      // ðŸ”µ ADDING ALL YOUR LAYERS FROM GITHUB
      const layers = [
        new GeoJSONLayer({ url: "Main_byggnad.geojson", renderer: buildingRenderer, title: "Main Building" }),
        new GeoJSONLayer({ url: "Oxnehaga_school.geojson", renderer: buildingRenderer, title: "School" }),
        new GeoJSONLayer({ url: "Oxnehaga-Area.geojson", title: "Area" }),
        new GeoJSONLayer({ url: "Huskvarna_train_station.geojson", title: "Train Station" }),
        new GeoJSONLayer({ url: "Oxnehaga_school_route.geojson", title: "School Route" }),
        new GeoJSONLayer({ url: "train.geojson", title: "Train Lines" })
      ];

      map.addMany(layers);

      // ðŸ–±ï¸ CLICK INTERACTION
      view.on("click", function(event) {
        view.hitTest(event).then(function(response) {
          if (response.results.length > 0 && response.results[0].graphic) {
            const attr = response.results[0].graphic.attributes;
            let html = "<ul>";
            for (let key in attr) {
              html += `<li><b>${key}:</b> ${attr[key]}</li>`;
            }
            html += "</ul>";
            document.getElementById("infoContent").innerHTML = html;
          }
        });
      });
    });
  </script>
</body>
</html>
